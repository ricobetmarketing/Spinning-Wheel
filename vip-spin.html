<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RicoBet VIP – Spin & Win</title>
<style>
  /* ===== RicoBet theme ===== */
  :root{
    --text:#f6f7ff; --dim:#cfd1ff;
    --rb-red:#ff2e55; --rb-pink:#ff6ec4; --rb-purple:#6c58ff; --rb-deep:#0a0e21;
    --gold1:#ffd36b; --gold2:#ffb436; --gold3:#ffcf7a; --warn:#ffe600;

    --wedgeDark:#ff7b44;   /* deeper orange-red */
    --wedgeLight:#ffc86a;  /* warm golden */
  }

  *{box-sizing:border-box}

  /* ===== Deep 3D stage background ===== */
  body{
    margin:0; color:var(--text);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    min-height:100dvh; display:grid; place-items:center; padding:18px;
    /* Base gradient + vignette */
    background:
      radial-gradient(1600px 1100px at 50% 0%, #3a1040 0%, #1a1139 45%, #120d2b 70%, #090b19 100%);
  }
  /* Top spotlight + bottom fog for depth */
  body::before,
  body::after{
    content:""; position:fixed; inset:0; pointer-events:none; z-index:0;
  }
  /* top glow spotlight & parallax rings */
  body::before{
    background:
      radial-gradient(1100px 600px at 50% -10%, #ff3e6a2a 0%, #0000 65%),
      radial-gradient(900px 500px at 50% -5%, #ffd36b26 0%, #0000 70%),
      /* soft ring echoes */
      radial-gradient(40% 40% at 50% 50%, #ffffff10 0 1px, #0000 2px) 50% 48%/42% 42% no-repeat,
      radial-gradient(40% 40% at 50% 50%, #ffffff08 0 1px, #0000 2px) 50% 48%/56% 56% no-repeat,
      radial-gradient(40% 40% at 50% 50%, #ffffff06 0 1px, #0000 2px) 50% 48%/70% 70% no-repeat;
    mix-blend-mode:screen;
  }
  /* bottom mist/vignette to “seat” the wheel */
  body::after{
    background:
      radial-gradient(60% 40% at 50% 110%, #000000aa, #0000 60%),
      radial-gradient(100% 100% at 50% 120%, #000000cc, #0000 40%);
  }

  /* Subtle floating bokeh particles */
  .bokeh i{
    position:fixed; width:8px; height:8px; border-radius:50%;
    background:radial-gradient(circle at 30% 30%, #fff, #fff0);
    opacity:.18; filter:blur(.5px); z-index:0;
    animation:bokeh 12s linear infinite;
  }
  .bokeh i:nth-child(1){left:14%; top:68%; animation-delay:-2s}
  .bokeh i:nth-child(2){left:78%; top:22%; animation-delay:-6s}
  .bokeh i:nth-child(3){left:8%;  top:18%; animation-delay:-9s}
  .bokeh i:nth-child(4){left:88%; top:76%; animation-delay:-4s}
  .bokeh i:nth-child(5){left:45%; top:10%; animation-delay:-7s}
  @keyframes bokeh{
    from{ transform:translateY(0) translateX(0) scale(.9); }
    to  { transform:translateY(-40px) translateX(30px) scale(1.2); }
  }

  /* ===== Card ===== */
  .card{
    width:min(760px,94vw); text-align:center; position:relative; z-index:1;
    background:linear-gradient(180deg,#17193d,#0f1230);
    border:1px solid #262a60; border-radius:20px;
    box-shadow:0 24px 60px rgba(0,0,0,.55), inset 0 1px 0 #2c3170;
    padding:18px 16px;
  }
  h2{margin:6px 0 4px; font-size:1.14rem}
  .grad{background:linear-gradient(90deg,var(--rb-pink),var(--rb-purple)); -webkit-background-clip:text; background-clip:text; color:transparent}
  .sub{margin:0 10px 12px; color:var(--dim)}

  /* ===== Buttons (animated) ===== */
  .btn{
    position:relative; display:inline-block; border:0; cursor:pointer; user-select:none;
    color:#0e0f23; font-weight:800; border-radius:999px; overflow:hidden;
    background:linear-gradient(90deg,var(--rb-pink),var(--rb-purple));
    padding:14px 24px; box-shadow:0 8px 22px rgba(120,115,245,.45), 0 8px 18px rgba(0,0,0,.35);
    transition:transform .15s ease, filter .2s ease, box-shadow .2s ease;
    animation:btnPulse 2.2s ease-in-out infinite;
  }
  .btn:hover{filter:brightness(1.08)}
  .btn:active{transform:scale(.98)}
  @keyframes btnPulse{
    0%,100%{box-shadow:0 0 16px rgba(120,115,245,.55), 0 0 28px rgba(255,46,85,.32)}
    50%    {box-shadow:0 0 26px rgba(120,115,245,.75), 0 0 42px rgba(255,46,85,.52)}
  }
  .btn::after{
    content:""; position:absolute; inset:0;
    background:linear-gradient(120deg, transparent, #ffffff66 40%, transparent 70%);
    transform:translateX(-120%); transition:transform .45s ease;
  }
  .btn:hover::after{transform:translateX(120%)}
  @keyframes clickPop{0%{transform:scale(1)}40%{transform:scale(1.08)}100%{transform:scale(1)}}
  .clicked{animation:clickPop .35s ease}

  /* ===== Wheel ===== */
  .wrap{ --W:min(84vw,480px); position:relative; display:grid; place-items:center; margin:16px auto 10px }
  .wrap::after{ /* ground shadow for lift */
    content:""; position:absolute; width:78%; height:18px; bottom:-12px; left:50%; transform:translateX(-50%);
    background:radial-gradient(closest-side, rgba(0,0,0,.52), rgba(0,0,0,0)); filter:blur(6px);
  }

  /* Backplate behind the wheel (adds separation + glow) */
  .backplate{
    position:absolute; width:calc(var(--W)*1.15); height:calc(var(--W)*1.15); border-radius:50%;
    background:
      radial-gradient(closest-side, #2a1a4f 0%, #170f37 55%, #0d0f24 85%),
      radial-gradient(60% 60% at 30% 30%, #ffffff18, transparent 60%);
    box-shadow:
      0 30px 80px rgba(0,0,0,.65),
      0 0 80px rgba(108,88,255,.18),
      inset 0 0 60px rgba(0,0,0,.35);
    z-index:0;
    animation:plateSpin 36s linear infinite;
  }
  @keyframes plateSpin{to{transform:rotate(360deg)}}

  /* Outer accent ring – slow clockwise */
  .outerRing{
    position:absolute; inset:calc(var(--W)*-.24); border-radius:50%; z-index:0; pointer-events:none;
    background:
      radial-gradient(circle at 50% 50%, #0000 68%, #20143d 69% 70%, #0000 71%),
      conic-gradient(from 0deg, #ffffff12 0 2deg, #0000 2deg 15deg) repeat,
      conic-gradient(from 8deg, #ffffff10 0 2deg, #0000 2deg 15deg) repeat;
    -webkit-mask:radial-gradient(circle, transparent 66%, #000 67% 100%); mask:radial-gradient(circle, transparent 66%, #000 67% 100%);
    animation:ringSpin 28s linear infinite;
  }
  @keyframes ringSpin{to{transform:rotate(360deg)}}

  /* Pointer */
  .pointer{
    position:absolute; top: calc(50% - (var(--W)/2) - 2px); left:50%; transform:translateX(-50%);
    width:0; height:0; z-index:7;
    border-left:14px solid transparent; border-right:14px solid transparent; border-top:28px solid var(--warn);
    filter:drop-shadow(0 2px 2px rgba(0,0,0,.6));
  }
  .pointer::after{
    content:""; position:absolute; top:-20px; left:-10px; width:20px; height:20px; border-radius:50%;
    background:radial-gradient(circle at 35% 35%, #fff, #ffd53a 45%, #e3aa00 70%);
    box-shadow:0 0 12px rgba(255,214,58,.7), inset 0 0 6px rgba(255,255,255,.85);
  }

  /* Main wheel */
  .wheel{
    position:relative; width:var(--W); height:var(--W); border-radius:50%; z-index:1;
    /* 8 alternating wedges */
    background:conic-gradient(from -22.5deg,
      var(--wedgeDark) 0 12.5%, var(--wedgeLight) 0 25%,
      var(--wedgeDark) 0 37.5%, var(--wedgeLight) 0 50%,
      var(--wedgeDark) 0 62.5%, var(--wedgeLight) 0 75%,
      var(--wedgeDark) 0 87.5%, var(--wedgeLight) 0 100%);
    /* face + rim depth */
    box-shadow:
      inset 0 0 0 12px #101235,
      inset 0 0 0 16px #1a1d3f,
      inset 22px 22px 46px rgba(0,0,0,.22),
      inset -10px -16px 26px rgba(255,255,255,.14),
      0 26px 60px rgba(0,0,0,.60);
    transition:transform 2.2s cubic-bezier(.22,.61,.36,1);
  }
  .wheel::before{ /* Gold bezel */
    content:""; position:absolute; inset:-22px; border-radius:50%;
    background:conic-gradient(from 90deg, var(--gold1), var(--gold2), var(--gold3), var(--gold1));
    box-shadow:inset 0 12px 20px rgba(255,255,255,.45), inset 0 -16px 24px rgba(132,84,0,.50), 0 12px 28px rgba(0,0,0,.45);
    z-index:-1;
  }
  .wheel::after{ /* glass sheen */
    content:""; position:absolute; inset:14px; border-radius:50%;
    background:
      radial-gradient(120% 80% at 30% 25%, #ffffff35 0 35%, transparent 55%),
      radial-gradient(120% 80% at 70% 75%, #00000033 0 28%, transparent 60%);
    box-shadow:inset 0 0 0 2px #171a38, inset 0 0 30px rgba(0,0,0,.35);
  }

  /* Borders between wedges + inner ticks */
  .seps{position:absolute; inset:0; pointer-events:none; z-index:3}
  .seps::before,.seps::after{
    content:""; position:absolute; border-radius:50%;
    -webkit-mask:radial-gradient(circle, transparent var(--cut,56%), #000 calc(var(--cut,56%) + 1%));
            mask:radial-gradient(circle, transparent var(--cut,56%), #000 calc(var(--cut,56%) + 1%));
  }
  .seps::before{ inset:20px; --cut:56%; background:conic-gradient(#7f5200 0 2.8deg, #0000 2.8deg 45deg) repeat;
                 filter:drop-shadow(0 0 2px rgba(255,229,120,.75)); }
  .seps::after{  inset:44px; --cut:45%; background:conic-gradient(#fff 0 1deg, #0000 1deg 45deg) repeat; opacity:.7; }

  /* Rim bulbs */
  .bulbs{position:absolute; inset:-6px; z-index:4; pointer-events:none; animation:bulbSpin 20s linear infinite reverse}
  @keyframes bulbSpin{to{transform:rotate(360deg)}}
  .bulbs i{
    position:absolute; left:50%; top:50%; width:14px; height:14px; border-radius:50%;
    background:radial-gradient(circle at 35% 35%, #fff, #8ee7ff 55%, #1bb3ff 80%);
    box-shadow:0 0 10px rgba(26,179,255,.7), inset 0 0 6px rgba(255,255,255,.9);
    transform:translate(-50%,-50%) rotate(var(--rot)) translate(calc(var(--W)/2 + 6px)) rotate(calc(-1*var(--rot)));
  }
  .bulbs i:nth-child(1){--rot:0deg}    .bulbs i:nth-child(2){--rot:30deg}
  .bulbs i:nth-child(3){--rot:60deg}   .bulbs i:nth-child(4){--rot:90deg}
  .bulbs i:nth-child(5){--rot:120deg}  .bulbs i:nth-child(6){--rot:150deg}
  .bulbs i:nth-child(7){--rot:180deg}  .bulbs i:nth-child(8){--rot:210deg}
  .bulbs i:nth-child(9){--rot:240deg}  .bulbs i:nth-child(10){--rot:270deg}
  .bulbs i:nth-child(11){--rot:300deg} .bulbs i:nth-child(12){--rot:330deg}

  /* Reward icons */
  .labs{position:absolute; inset:0; z-index:2; pointer-events:none}
  .lab{ position:absolute; left:50%; top:50%; transform-origin:center; --r: calc(var(--W) * .34); --theta: 0deg;
        transform:translate(-50%,-50%) rotate(var(--theta)) translateY(calc(-1 * var(--r))); }
  .lab img{ width:60px; height:60px; object-fit:contain; filter:drop-shadow(0 4px 8px rgba(0,0,0,.45)); }
  .lab.a{ --theta:   0deg; } .lab.b{ --theta:  45deg; }
  .lab.c{ --theta:  90deg; } .lab.d{ --theta: 135deg; }
  .lab.e{ --theta: 180deg; } .lab.f{ --theta: 225deg; }
  .lab.g{ --theta: 270deg; } .lab.h{ --theta: 315deg; }

  /* Center logo hub – slow counter rotation; clickable */
  .hub{
    position:absolute; z-index:6; left:50%; top:50%; transform:translate(-50%,-50%);
    width:calc(var(--W)*.30); height:calc(var(--W)*.30); max-width:132px; max-height:132px;
    border-radius:50%; cursor:pointer;
    background:radial-gradient(circle at 60% 40%, #21264f 0 25%, #12163a 55%, #0a0d22 100%);
    box-shadow:inset 0 10px 18px rgba(255,255,255,.06), inset 0 -14px 22px rgba(0,0,0,.6),
               0 12px 24px rgba(0,0,0,.55), 0 0 22px rgba(120,115,245,.25);
    display:grid; place-items:center; overflow:hidden; transition:transform .15s ease, filter .2s ease;
    animation:hubSlow 26s linear infinite reverse;
  }
  @keyframes hubSlow{to{transform:translate(-50%,-50%) rotate(360deg)}}
  .hub:hover{filter:brightness(1.06); transform:translate(-50%,-50%) scale(1.03)}
  .hub:active{transform:translate(-50%,-50%) scale(.98)}
  .hub .shine{ position:absolute; inset:-30%;
    background:conic-gradient(from 0deg,#ffffff18 0 8%, #0000 8% 25%, #ffffff14 25% 33%, #0000 33% 50%, #ffffff10 50% 58%, #0000 58% 100%);
    pointer-events:none;
  }
  .hub img{ width:72%; height:72%; object-fit:contain; filter:drop-shadow(0 4px 8px rgba(0,0,0,.55)); }

  /* ===== Win Modal ===== */
  .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:20}
  .modal.show{display:flex}
  .backdrop{position:absolute; inset:0; background:rgba(5,7,18,.80); backdrop-filter:blur(2px)}

  .win{
    position:relative; z-index:1; width:min(580px,92vw); color:#fff;
    border-radius:18px; padding:24px 20px 18px; text-align:center;
    background:linear-gradient(180deg,#2e1027,#1a113b);
    box-shadow:0 24px 68px rgba(0,0,0,.65), inset 0 0 0 1px #3a1537;
    overflow:visible;              /* let tokens fly outside */
    isolation:isolate;
  }
  .xbtn{position:absolute; right:10px; top:10px; border:0; width:36px; height:36px; border-radius:50%;
        color:#fff; background:rgba(255,255,255,.14); cursor:pointer}
  .badge{display:inline-block; padding:8px 12px; border-radius:999px; font-weight:900; letter-spacing:.3px;
         background:linear-gradient(90deg,var(--rb-red),var(--rb-purple)); box-shadow:0 8px 18px rgba(255,46,85,.35); margin-top:6px}
  .prizeTop{width:120px; height:120px; object-fit:contain; display:block; margin:6px auto 2px; filter:drop-shadow(0 8px 16px rgba(0,0,0,.55))}
  .title{font-size:1.7rem; font-weight:900; margin:8px 0 8px}
  .highlight{color:#ffe25f; text-shadow:0 1px 0 #8a5f00}
  .codeRow{display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; margin-top:12px}
  .codeInp{flex:1 1 260px; min-width:220px; padding:12px; border-radius:12px; border:1px solid #3a3e86;
           background:#0f122d; color:#fff; font-family:ui-monospace,Menlo,Consolas,monospace; font-size:1rem}
  .copyBtn{padding:12px 18px}

  /* flying tokens around modal — now fly OUTwards once */
  .fly{
    position:absolute; width:110px; height:110px; object-fit:contain;
    filter:drop-shadow(0 14px 20px rgba(0,0,0,.5)); opacity:0; pointer-events:none; z-index:1;
  }
  .prizeTop,.badge,.title,.codeRow{ position:relative; z-index:2; }

  @keyframes flyOutA {
    0%   { transform: translate(0,0) scale(.8) rotate(0deg); opacity:1; }
    60%  { transform: translate(-120px,-80px) scale(1.1) rotate(-15deg); opacity:.8; }
    100% { transform: translate(-240px,-160px) scale(1.2) rotate(-25deg); opacity:0; }
  }
  @keyframes flyOutB {
    0%   { transform: translate(0,0) scale(.8) rotate(0deg); opacity:1; }
    60%  { transform: translate(120px,-80px) scale(1.1) rotate(15deg); opacity:.8; }
    100% { transform: translate(240px,-160px) scale(1.2) rotate(25deg); opacity:0; }
  }
  @keyframes flyOutC {
    0%   { transform: translate(0,0) scale(.8) rotate(0deg); opacity:1; }
    60%  { transform: translate(-80px,100px) scale(1.1) rotate(10deg); opacity:.8; }
    100% { transform: translate(-160px,200px) scale(1.2) rotate(20deg); opacity:0; }
  }
  @keyframes flyOutD {
    0%   { transform: translate(0,0) scale(.8) rotate(0deg); opacity:1; }
    60%  { transform: translate(80px,100px) scale(1.1) rotate(-10deg); opacity:.8; }
    100% { transform: translate(160px,200px) scale(1.2) rotate(-20deg); opacity:0; }
  }
  .fly.one   { left:0;  top:10%;   animation:flyOutA 4s ease-out forwards; }
  .fly.two   { right:0; top:20%;   animation:flyOutB 4s ease-out forwards .25s; }
  .fly.three { left:0;  bottom:0;  animation:flyOutC 4s ease-out forwards .5s; }
  .fly.four  { right:0; bottom:0;  animation:flyOutD 4s ease-out forwards .75s; }
</style>
</head>
<body>
  <!-- floating background particles -->
  <div class="bokeh" aria-hidden="true"><i></i><i></i><i></i><i></i><i></i></div>

  <div class="card" id="card" data-done="0">
    <h2><span class="grad">VIP Day</span> – Spin the Wheel 🎡</h2>
    <p class="sub">Tap the button or the center logo to spin and reveal your voucher.</p>

    <button class="btn" id="spinBtn">Spin Now</button>

    <div class="wrap" id="wrap">
      <div class="backplate" aria-hidden="true"></div>
      <div class="outerRing" aria-hidden="true"></div>
      <div class="pointer" aria-hidden="true"></div>

      <div class="wheel" id="wheel">
        <div class="seps" aria-hidden="true"></div>
        <div class="bulbs" aria-hidden="true">
          <i></i><i></i><i></i><i></i><i></i><i></i>
          <i></i><i></i><i></i><i></i><i></i><i></i>
        </div>

        <!-- 8 rewards (4 × 2) -->
        <div class="labs" aria-hidden="true">
          <div class="lab a"><img alt="Free Spins"   src="https://ricobr.ft-crm.com/media-api/serve/81b24fae-5e7b-468e-b94a-896bc0e9cada_1.png"></div>
          <div class="lab b"><img alt="Lucky Ticket" src="https://ricobr.ft-crm.com/media-api/serve/f64adfc8-2762-4868-a84f-9e1e79e5dcd0_3.png"></div>
          <div class="lab c"><img alt="VIP Bonus"    src="https://ricobr.ft-crm.com/media-api/serve/0ba51d0c-9521-4fbb-8b37-6d527a545463_4.png"></div>
          <div class="lab d"><img alt="Mystery"      src="https://ricobr.ft-crm.com/media-api/serve/9cc65950-210b-4f56-995f-e4a94dd1d82c_2.png"></div>
          <div class="lab e"><img alt="Free Spins"   src="https://ricobr.ft-crm.com/media-api/serve/81b24fae-5e7b-468e-b94a-896bc0e9cada_1.png"></div>
          <div class="lab f"><img alt="Lucky Ticket" src="https://ricobr.ft-crm.com/media-api/serve/f64adfc8-2762-4868-a84f-9e1e79e5dcd0_3.png"></div>
          <div class="lab g"><img alt="VIP Bonus"    src="https://ricobr.ft-crm.com/media-api/serve/0ba51d0c-9521-4fbb-8b37-6d527a545463_4.png"></div>
          <div class="lab h"><img alt="Mystery"      src="https://ricobr.ft-crm.com/media-api/serve/9cc65950-210b-4f56-995f-e4a94dd1d82c_2.png"></div>
        </div>
      </div>

      <!-- Center logo hub (click to spin) -->
      <button class="hub" id="hub" aria-label="Spin the wheel">
        <div class="shine" aria-hidden="true"></div>
        <img alt="RicoBet Logo" src="https://ricobr.ft-crm.com/media-api/serve/fdc9eb88-2c14-4eeb-a6e7-558cbd47176d_logo.png">
      </button>
    </div>
  </div>

  <!-- Win Modal: shows voucher with copy -->
  <div class="modal" id="modal">
    <div class="backdrop"></div>
    <div class="win" role="dialog" aria-modal="true" aria-labelledby="winTitle">
      <button class="xbtn" id="closeModal" aria-label="Close">✕</button>

      <!-- Flying tokens (outward) -->
      <img class="fly one"   src="https://ricobr.ft-crm.com/media-api/serve/edd88eaa-1a49-4ef0-a085-09ee744e3ebf_ICON.png" alt="">
      <img class="fly two"   src="https://ricobr.ft-crm.com/media-api/serve/af665c42-6b20-4ab0-b3e1-69d75744b739_Free_Spin.png" alt="">
      <img class="fly three" src="https://ricobr.ft-crm.com/media-api/serve/af665c42-6b20-4ab0-b3e1-69d75744b739_Free_Spin.png" alt="">
      <img class="fly four"  src="https://ricobr.ft-crm.com/media-api/serve/edd88eaa-1a49-4ef0-a085-09ee744e3ebf_ICON.png" alt="">

      <!-- Top image -->
      <img class="prizeTop" alt="RicoBet Prize" src="https://ricobr.ft-crm.com/media-api/serve/edd88eaa-1a49-4ef0-a085-09ee744e3ebf_ICON.png">
      <div class="badge">YOU WIN</div>
      <div id="winTitle" class="title"><span class="highlight" id="winName">Reward</span> Unlocked</div>

      <div class="codeRow">
        <input id="codeModal" class="codeInp" value="" readonly>
        <button class="btn copyBtn" id="copyModal">Copy</button>
      </div>
    </div>
  </div>

<script>
(function(){
  const wheel   = document.getElementById('wheel');
  const spinBtn = document.getElementById('spinBtn');
  const hub     = document.getElementById('hub');
  const modal   = document.getElementById('modal');
  const closeM  = document.getElementById('closeModal');
  const copyM   = document.getElementById('copyModal');
  const codeM   = document.getElementById('codeModal');
  const winName = document.getElementById('winName');
  const card    = document.getElementById('card');

  // 8 outcomes (each voucher appears twice)
  const OUTCOMES = [
    { code:'AURA',  name:'AURA',  angle:  0 },
    { code:'VSTAR', name:'VSTAR', angle: 45 },
    { code:'CHAMP', name:'CHAMP', angle: 90 },
    { code:'VIPGO', name:'VIPGO', angle:135 },
    { code:'AURA',  name:'AURA',  angle:180 },
    { code:'VSTAR', name:'VSTAR', angle:225 },
    { code:'CHAMP', name:'CHAMP', angle:270 },
    { code:'VIPGO', name:'VIPGO', angle:315 }
  ];

  const KEY_DONE='rb_spin_done';
  const KEY_CODE='rb_spin_code';
  const KEY_IDX ='rb_spin_idx';

  function addClickAnim(el){
    if(!el) return;
    el.addEventListener('click',()=>{ el.classList.remove('clicked'); void el.offsetWidth; el.classList.add('clicked'); setTimeout(()=>el.classList.remove('clicked'),350); });
  }
  [spinBtn, copyM, hub].forEach(addClickAnim);

  // Copy helper
  async function copyTxt(v){
    try{
      if(navigator.clipboard){ await navigator.clipboard.writeText(v); }
      else{ const t=document.createElement('textarea'); t.value=v; document.body.appendChild(t); t.select(); document.execCommand('copy'); t.remove(); }
    }catch(e){ alert('Copy failed. Please long-press and copy manually.'); }
  }
  copyM.addEventListener('click', ()=>copyTxt(codeM.value));

  // Modal controls
  function showModal(code, name){
    codeM.value = code;
    winName.textContent = name;
    modal.classList.add('show');
  }
  function hideModal(){ modal.classList.remove('show'); }
  document.getElementById('closeModal').addEventListener('click', hideModal);
  modal.querySelector('.backdrop').addEventListener('click', hideModal);

  // Restore if already played (one-spin policy)
  if(localStorage.getItem(KEY_DONE)==='1'){
    const idx = parseInt(localStorage.getItem(KEY_IDX),10);
    const code= localStorage.getItem(KEY_CODE);
    if(!Number.isNaN(idx) && code){
      const o = OUTCOMES[idx % OUTCOMES.length] || {name:'Reward', angle:0};
      wheel.style.transform='rotate('+o.angle+'deg)';   // stop at recorded angle
      spinBtn.disabled = true;
      card.setAttribute('data-done','1');
      showModal(code, o.name);                           // show voucher immediately
    }
  }

  function pick(){ return Math.floor(Math.random()*OUTCOMES.length); }

  // Spin control (2–3 turns only)
  function triggerSpin(){
    if(card.getAttribute('data-done')==='1') return;
    spinBtn.disabled = true;

    const idx = pick();
    const o   = OUTCOMES[idx];
    const turns = 2 + Math.floor(Math.random()*2); // 2..3 turns
    const final = turns*360 + o.angle;
    const over  = final + 24;

    wheel.style.transition='transform 1.9s cubic-bezier(.22,.61,.36,1)';
    wheel.style.transform='rotate('+over+'deg)';
    setTimeout(()=>{
      wheel.style.transition='transform .6s cubic-bezier(.25,.9,.25,1)';
      wheel.style.transform='rotate('+final+'deg)';
    },1900);

    setTimeout(()=>{
      localStorage.setItem(KEY_DONE,'1');
      localStorage.setItem(KEY_IDX, String(idx));
      localStorage.setItem(KEY_CODE, o.code);
      card.setAttribute('data-done','1');
      showModal(o.code, o.name);
    },2600);
  }

  // Triggers
  spinBtn.addEventListener('click', (e)=>{ e.preventDefault(); triggerSpin(); });
  hub.addEventListener('click', (e)=>{ e.preventDefault(); triggerSpin(); });
  hub.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' ') {e.preventDefault(); triggerSpin();} });
})();
</script>
</body>
</html>
